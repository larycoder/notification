<!DOCTYPE html>

<head>
    <title>Detail Note</title>
    <script src="js/api.js"></script>
    <script src="js/data.js"></script>
    <script src="js/render.js"></script>
    <script>
        var params;
        function getObject() {
            let url = window.location.href;
            params = convertUrlParamToJson(url);

            url = "/noteApi/";
            url += params["type"] + "/" + params["id"];

            let data = callSimpleApi("GET", url);
            return getObjectFromResponse(data, 0);
        }

        function renderInfo() {
            let obj = getObject();
            let notes = document.getElementById("notes_data");
            let extra = document.getElementById("extra_info");

            // task render
            if(params.type == "diary") {
                document.getElementById("task_title").innerHTML = "Activity: ";
                document.getElementById("task_data").value = obj.activity;
                delete obj.activity;
            } else {
                document.getElementById("task_title").innerHTML = "Task: ";
                document.getElementById("task_data").value = obj.task;
                delete obj.task;
            }

            // notes render
            notes.innerHTML = obj.notes;
            delete obj.notes;

            // extra info render
            for(let key of Object.keys(obj)) {
                let id = "extra_info_value_" + key;
                let value = obj[key];
                obj[key] = `<input type="text" id="${id}" value= "${value}">`;
            }

            let dataAsArray = convertObjToArray(["key", "value"], obj);
            let dataAsRespObj = {
                "count": dataAsArray.length,
                "data": dataAsArray
            }
            extra.innerHTML = renderJsonAsTable(dataAsRespObj, "extra_info");

            modifyDOMProperties();
        }

    </script>
    <script>
        // script to modify DOM properties
        function modifyDOMProperties() {
            // allow tab in textarea of notes
            document.getElementById('notes_data').addEventListener('keydown', function(e) {
                if (e.key == 'Tab') {
                    e.preventDefault();
                    let start = this.selectionStart;
                    let end = this.selectionEnd;
                    this.value = this.value.substring(0, start + 1) +
                        "    " + this.value.substring(end + 1);

                    // put caret at right position again
                    this.selectionStart = this.selectionEnd = start + 4;
                }
            });
        }
    </script>
</head>

<body>
<div>
    <h2>Note Detail</h2>
    <button style="margin-bottom: 20px" type="button">Save</button>
</div>
<div>
    <div style="float:left">
        <div id="task">
            <label for="task_data" id="task_title"></label>
            <input style="width:58vw" id="task_data">
        </div>
        <div id="notes">
            <h4>Notes: </h4>
            <textarea id="notes_data" style="width: 60vw; height: 70vh;"></textarea>
        </div>
    </div>
    <div style="float:right" id="extra_info"></div>
</div>
<script>renderInfo();</script>
</body>