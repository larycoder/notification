<!DOCTYPE html>

<head>
    <title>List Note</title>
    <script src="js/api.js"></script>
    <script src="js/data.js"></script>
    <script src="js/render.js"></script>
    <script>
        // table information script
        function createInfoTable() {
            let opt = document.getElementById("log_opt_type").value;
            let data = callSimpleApi("GET", "/noteApi/" + opt);
            data = convertTextToJson(data);
            document.getElementById("info").innerHTML = renderJsonAsTable(data, "info");
        }

        function addDetailNotePageToTable() {
            let table = document.getElementById("info_table");
            let idValues = getColumnValuesOfTable(table, "id");
            let opt = document.getElementById("log_opt_type").value;

            let linkValues = [];
            for(id of idValues) {
                let link = "detailNote.html?id=" + id + "&type=" + opt;
                let tag = "<a href = \"" + link + "\">ref</a>";
                linkValues.push(tag);
            }
            addColToTable(table, "detail", linkValues);
        }

        function showInfoTable() {
            createInfoTable();
            addDetailNotePageToTable();
        }
    </script>
    <script>
        // new note dialog script
        function renderInputTag(field, posId) {
            text = ""
            if(field == "notes") {
                text += `<textarea id="${posId}_${field}">`;
                text += `</textarea>`;
            } else {
                text += `<input `;
                text += `id = "${posId}_${field}" type="text" name="${field}"`;
                text += `>`;
            }
            return text;
        }

        function getFieldsByType(type) {
            if(type == "task") {
                return [
                    "task", "parentId", "notes", "label",
                    "priority", "deadline", "measurement", "process"
                ];
            } else {
                return [
                    "activity", "notes", "start_time", "duration", "taskId"
                ]
            }
        }

        function toggleBox() {
            let opt = document.getElementById("log_opt_type").value;
            let fields = getFieldsByType(opt);

            let box = document.getElementById("new_note_box");
            let boxData = renderInputBox(fields, renderInputTag);
            box.innerHTML = boxData;
            box.style.display = "block";
        }
    </script>
</head>

<body>
    <h2>Dashboard</h2>
    <div id="log_opt">
        <label for="log_opt_type">Log Type:</label>
        <select id="log_opt_type">
            <option value="task" selected>task</option>
            <option value="diary">diary</option>
        </select>
        <button type="button" onclick="showInfoTable()">Submit</button>
        <button type="button" onclick="toggleBox()">New</button>
    </div>
    <div style="display:none" id="new_note_box"></div>
    <div id="info"></div>
</body>